---
- name:                 "Verifiy if Profile already exists"
  stat:
    path:               "{{ __was_install_location }}/profiles/{{ __profile_name }}"
  register:             profile_already_exists

- name:          "Is dmgr Running?"
  community.general.pids:
    name:        java
  register:      dmgr_is_running

- name: Set dmgr.pid file
  ansible.builtin.set_fact:
    dmgr_pid_file_name: "{{ __was_install_location }}/profiles/{{ __profile_name }}/logs/dmgr/dmgr.pid"

- name: Check if dmgr.pid exists
  stat:
    path:       "{{ dmgr_pid_file_name }}"
  register:   dmgr_pid_file

- name: Get pid from dmgr.pid
  ansible.builtin.slurp:
    src:          "{{ dmgr_pid_file_name }}"
  register: dmgr_pid_b64
  when:
    - dmgr_pid_file.stat.exists

- name:                 "Verifiy if Application Security is already configured"
  stat:
    path:               "{{ __success_file }}"
  register:             app_sec_already_configured
  when:                 profile_already_exists.stat.exists |bool

- name:                 "Enable Application Security"
  include_tasks:        enable_app_sec.yml
  when:                 not app_sec_already_configured.stat.exists
